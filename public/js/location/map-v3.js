(()=>{"use strict";function e(){$.each($(".delete-confirm"),(function(){$(this).click((function(e){var a=$(this).data("name"),n=$(this).data("delete-target"),i=$(this).data("target");$(i).find(".target-name").text(a),$(this).data("mirrored")?$("#delete-confirm-mirror").show():$("#delete-confirm-mirror").hide(),$(this).data("recoverable")?($(i).find(".permanent").hide(),$(i).find(".recoverable").show()):($(i).find(".recoverable").hide(),$(i).find(".permanent").show()),n&&$(".delete-confirm-submit").data("target",n)}))})),$.each($(".delete-confirm-submit"),(function(e){$(this).unbind("click"),$(this).click((function(e){var a=$(this).data("target");a?($("#"+a+" input[name=remove_mirrored]").val($("#delete-confirm-mirror-checkbox").is(":checked")?1:0),$("#"+a).submit()):$("#delete-confirm-form").submit()}))}))}var a,n,i,t,o,r,l,d,s,c,m,p;function h(){$(".map-legend-marker").click((function(e){e.preventDefault(),window.map.panTo(L.latLng($(this).data("lat"),$(this).data("lng"))),window[$(this).data("id")].openPopup()})),$("a.sidebar-toggle").click((function(){f()}))}function f(){setTimeout((function(){window.map.invalidateSize()}),500)}function u(){$("#marker-main-fields").show(),$("#marker-footer").show()}$(document).ready((function(){window.map.invalidateSize(),window.map.on("popupopen",(function(a){e()})),$('a[href="#marker-pin"]').click((function(e){$('input[name="shape_id"]').val(1),$("#map-marker-bg-colour").show(),u()})),$('a[href="#marker-label"]').click((function(e){$('input[name="shape_id"]').val(2),$("#map-marker-bg-colour").hide(),u()})),$('a[href="#marker-circle"]').click((function(e){$('input[name="shape_id"]').val(3),$("#map-marker-bg-colour").show(),u()})),$('a[href="#marker-poly"]').click((function(e){$('input[name="shape_id"]').val(5),$("#map-marker-bg-colour").show(),u()})),$('a[href="#presets"]').click((function(e){!function(e){if($("#marker-main-fields").hide(),$("#marker-footer").hide(),0===$(".marker-preset-list .fa-spinner").length)return;console.log("load from",e),$.ajax({url:e}).done((function(e){$(".marker-preset-list").html(e),$(".preset-use").on("click",(function(e){e.preventDefault();var a=$(this).data("url");$(this).find(".fa-spin").show(),$.ajax({url:a,context:this}).done((function(e){$(this).find(".fa-spin").hide(),Object.keys(e.preset).forEach((function(a){var n=e.preset[a],i=$('[name="'+a+'"]');0!==i.length?a.endsWith("colour")?i.spectrum("set",n):i.val(n):console.info("markerPreset","unknown field",a)})),$('a[href="#marker-pin"]').click()}))}))}))}($(this).data("presets"))})),$('a[href="#form-markers"]').click((function(e){window.map.invalidateSize()})),function(){if(0===(a=$("#map-body")).length)return;n=$("#sidebar-map"),i=$("#sidebar-marker"),t=$("#map-marker-modal"),r=$("#map-marker-modal-title"),o=$("#map-marker-modal-content"),window.markerDetails=function(l){!function(){if(window.kankaIsMobile.matches)return o.find(".spinner").show(),o.find(".content").hide(),void t.modal("toggle");a.removeClass("sidebar-collapse").addClass("sidebar-open"),n.hide(),i.html("").show(),i.parent().find(".spinner").show(),f()}(),window.kankaIsMobile.matches&&(l+="?mobile=1"),$.ajax({url:l,type:"GET",async:!0,success:function(t){t&&(window.kankaIsMobile.matches?(r.html(t.name),o.find(".content").html(t.body).show(),o.find(".spinner").hide()):(i.html(t.body).show().parent().find(".spinner").hide(),$(".marker-close").click((function(e){i.hide(),n.show()})),a.addClass("sidebar-open")),e())}})},h()}(),function(){$('select[name="size_id"]').change((function(e){6==this.value?($(".map-marker-circle-helper").hide(),$(".map-marker-circle-radius").show()):($(".map-marker-circle-radius").hide(),$(".map-marker-circle-helper").show())})),$('input[name="custom_icon"]').on("paste",(function(e){var a;if(e.preventDefault(),e.clipboardData||e.originalEvent.clipboardData?a=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(a=window.clipboardData.getData("Text")),a.startsWith('<i class="fa')||a.startsWith('<i class="ra')){var n=$(a).attr("class");if(n)return void $(this).val(n)}$(this).val(a)}));var e=$("#map-marker-form");if(0===$("#entity-form").length&&0===$(".map-marker-edit-form").length)return;e.unbind("submit").on("submit",(function(){window.entityFormHasUnsavedChanges=!1})),h()}(),$(".map-marker-entry-click").click((function(e){e.preventDefault(),$(this).parent().hide(),$(".map-marker-entry-entry").show()})),$("#start-drawing-polygon").on("click",(function(e){e.preventDefault(),window.drawingPolygon=!0,window.showToast($(this).data("toast")),$("body").addClass("map-drawing-mode"),$("#marker-modal").modal("hide")})),(l=$("#reset-polygon")).click((function(e){e.preventDefault(),window.polygon&&window.map.removeLayer(window.polygon),$('textarea[name="custom_shape"]').val(""),l.hide()})),$(".btn-mode-enable").click((function(e){e.preventDefault(),window.exploreEditMode=!0,$("body").addClass("map-edit-mode")})),$(".btn-mode-disable").click((function(e){e.preventDefault(),window.exploreEditMode=!1,$("body").removeClass("map-edit-mode")})),$(".btn-mode-drawing").click((function(e){e.preventDefault(),window.drawingPolygon=!1,$("body").removeClass("map-drawing-mode"),$("#marker-modal").modal("show")}))})),window.addPolygonPosition=function(e,a){var n=$('textarea[name="custom_shape"]'),i=n.val();i.length>0&&(i+=" "),n.val(i+e+","+a);var t=n.val().trim(" ").split(" "),o=[];t.forEach((function(e){var a=e.split(",");o.push([a[0],a[1]])}),o),window.polygon&&window.map.removeLayer(window.polygon),function(){(!(s=$('input[name="polygon_style[stroke]"]').val())||s.length<7)&&(s="red");c=$('input[name="polygon_style[stroke-opacity]"]').val(),isNaN(c)||!c?c=1:c/=100;(!(m=$('input[name="colour"]').val())||m.length<7)&&(m="red");p=$('input[name="opacity"]').val(),isNaN(p)?p=.5:p/=100;d=$('input[name="polygon_style[stroke-width]"]').val(),(isNaN(d)||!d)&&(d=1)}(),window.polygon=L.polygon(o,{weight:d,color:s,opacity:c,fillColor:m,fillOpacity:p,linecap:"round",linejoin:"round"}),window.polygon.addTo(window.map),l.show()}})();
//# sourceMappingURL=map-v3.js.map