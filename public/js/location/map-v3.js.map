{"version":3,"file":"/js/location/map-v3.js","mappings":"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","sources":["webpack:///./resources/assets/js/components/delete-confirm.js","webpack:///./resources/assets/js/location/map-v3.js"],"sourcesContent":["export default function deleteConfirm() {\n    // Delete confirm dialog\n    $.each($('.delete-confirm'), function () {\n        $(this).click(function (e) {\n            let name = $(this).data('name');\n            let target = $(this).data('delete-target');\n            let targetModal = $(this).data('target');\n\n            $(targetModal).find('.target-name').text(name);\n\n            if ($(this).data('mirrored')) {\n                $('#delete-confirm-mirror').show();\n            } else {\n                $('#delete-confirm-mirror').hide();\n            }\n\n            if ($(this).data('recoverable')) {\n                $(targetModal).find('.permanent').hide();\n                $(targetModal).find('.recoverable').show();\n            } else {\n                $(targetModal).find('.recoverable').hide();\n                $(targetModal).find('.permanent').show();\n            }\n\n            if (target) {\n                $('.delete-confirm-submit').data('target', target);\n            }\n        });\n    });\n\n\n    // Submit modal form\n    $.each($('.delete-confirm-submit'), function (index) {\n        $(this).unbind('click');\n        $(this).click(function (e) {\n            var target = $(this).data('target');\n            //console.log('Submit delete confirmation', target);\n            if (target) {\n                $('#' + target + ' input[name=remove_mirrored]').val(\n                    $('#delete-confirm-mirror-checkbox').is(':checked') ? 1 : 0\n                );\n                //console.log('target', target, $('#' + target));\n                $('#' + target).submit();\n            } else {\n                $('#delete-confirm-form').submit();\n            }\n        })\n    });\n}\n","import deleteConfirm from \"../components/delete-confirm\";\n\n//require ('leaflet.markercluster/dist/leaflet.markercluster');\n//require ('leaflet.markercluster.layersupport');\n\nvar mapPageBody;\nvar sidebarMap, sidebarMarker;\nvar markerModal, markerModalContent, markerModalTitle;\n\n$(document).ready(function() {\n\n    window.map.invalidateSize();\n    //deleteConfirm();\n\n    window.map.on('popupopen', function (ev) {\n        deleteConfirm();\n    });\n\n    // Event fired when clicking on an existing map point\n\n    $('a[href=\"#marker-pin\"]').click(function (e) {\n        $('input[name=\"shape_id\"]').val(1);\n        $('#map-marker-bg-colour').show();\n    });\n    $('a[href=\"#marker-label\"]').click(function (e) {\n        $('input[name=\"shape_id\"]').val(2);\n        $('#map-marker-bg-colour').hide();\n    });\n    $('a[href=\"#marker-circle\"]').click(function (e) {\n        $('input[name=\"shape_id\"]').val(3);\n        $('#map-marker-bg-colour').show();\n    });\n    $('a[href=\"#marker-poly\"]').click(function (e) {\n        $('input[name=\"shape_id\"]').val(5);\n        $('#map-marker-bg-colour').show();\n    });\n    $('a[href=\"#form-markers\"]').click(function (e) {\n        window.map.invalidateSize();\n    });\n\n    initMapExplore();\n    initMapForms();\n    initMapEntryClick();\n});\n\n/**\n *\n */\nfunction initMapExplore()\n{\n    //console.log('initMapExplore', '');\n    mapPageBody = $('#map-body');\n    if (mapPageBody.length === 0) {\n        //console.log('initMapExplore', 'no explore mode');\n        return;\n    }\n    sidebarMap = $('#sidebar-map');\n    sidebarMarker = $('#sidebar-marker');\n    markerModal = $('#map-marker-modal');\n    markerModalTitle = $('#map-marker-modal-title');\n    markerModalContent = $('#map-marker-modal-content');\n\n    window.markerDetails = function(url) {\n        showSidebar();\n        if (window.kankaIsMobile.matches) {\n            url = url + '?mobile=1';\n        }\n        $.ajax({\n            url: url,\n            type: 'GET',\n            async: true,\n            success: function (result) {\n                if (result) {\n                    if (window.kankaIsMobile.matches) {\n                        markerModalTitle.html(result.name);\n                        markerModalContent.find('.content').html(result.body).show();\n                        markerModalContent.find('.spinner').hide();\n                    } else {\n                        sidebarMarker.html(result.body).show()\n                            .parent().find('.spinner').hide();\n\n                        handleCloseMarker();\n                        mapPageBody.addClass('sidebar-open');\n                    }\n                    deleteConfirm();\n                }\n            }\n        })\n    }\n\n    initLegend();\n    registerModes();\n}\n\n/**\n * When submitting the layer or marker form from the map modal, disable the map form unsaved changed\n * alert.\n */\nfunction initMapForms()\n{\n    $('select[name=\"size_id\"]').change(function (e) {\n        if (this.value == 6) {\n            $('.map-marker-circle-helper').hide();\n            $('.map-marker-circle-radius').show();\n        } else {\n            $('.map-marker-circle-radius').hide();\n            $('.map-marker-circle-helper').show();\n        }\n    });\n\n    //console.info('mapsv3', 'initMapForms');\n    let layerForm = $('#map-layer-form');\n    let markerForm = $('#map-marker-form');\n    let groupForm = $('#map-group-form');\n    if ($('#entity-form').length === 0 && $('.map-marker-edit-form').length === 0) {\n        //console.info('initMapForms empty');\n        return;\n    }\n\n    layerForm.unbind('submit').on('submit', function() {\n        window.entityFormHasUnsavedChanges = false;\n    });\n    markerForm.unbind('submit').on('submit', function() {\n        window.entityFormHasUnsavedChanges = false;\n    });\n    groupForm.unbind('submit').on('submit', function() {\n        window.entityFormHasUnsavedChanges = false;\n    });\n\n    initLegend();\n}\n\nfunction showSidebar()\n{\n    // On mobile use the modal instead of the sidebar\n    if (window.kankaIsMobile.matches) {\n        markerModalContent.find('.spinner').show();\n        markerModalContent.find('.content').hide();\n        markerModal.modal('toggle');\n        return;\n    }\n\n    //window.map.invalidateSize();\n    mapPageBody.removeClass('sidebar-collapse').addClass('sidebar-open');\n    sidebarMap.hide();\n    sidebarMarker.html('').show();\n    sidebarMarker.parent().find('.spinner').show();\n    invalidateMapOnSidebar();\n}\n\nfunction handleCloseMarker()\n{\n    $('.marker-close').click(function (ev) {\n        sidebarMarker.hide();\n        sidebarMap.show();\n    });\n}\n\nfunction initLegend()\n{\n    $('.map-legend-marker').click(function (ev) {\n        ev.preventDefault();\n        window.map.panTo(L.latLng($(this).data('lat'), $(this).data('lng')));\n        window[$(this).data('id')].openPopup();\n    });\n\n    $('a.sidebar-toggle').click(function () {\n        invalidateMapOnSidebar();\n        //console.log('wat');\n    });\n}\nfunction invalidateMapOnSidebar() {\n    setTimeout(() => {\n        // Invalidate the map size when the sidebar is rendered/hidden\n        window.map.invalidateSize();\n    }, 500);\n}\nfunction initMapEntryClick() {\n    $('.map-marker-entry-click').click(function (e) {\n        e.preventDefault();\n        $(this).parent().hide();\n        $('.map-marker-entry-entry').show();\n    });\n}\n\n/**\n * Register switching in and out of edit mode\n */\nfunction registerModes() {\n    $('.btn-mode-enable').click(function (e) {\n        e.preventDefault();\n        window.explodeEditMode = true;\n        $('body').addClass('map-edit-mode');\n    });\n    $('.btn-mode-disable').click(function (e) {\n        e.preventDefault();\n        window.explodeEditMode = false;\n        $('body').removeClass('map-edit-mode');\n    });\n}\n"],"names":["deleteConfirm","$","each","this","click","e","name","data","target","targetModal","find","text","show","hide","index","unbind","val","is","submit","mapPageBody","sidebarMap","sidebarMarker","markerModal","markerModalContent","markerModalTitle","initLegend","ev","preventDefault","window","map","panTo","L","latLng","openPopup","invalidateMapOnSidebar","setTimeout","invalidateSize","document","ready","on","length","markerDetails","url","kankaIsMobile","matches","modal","removeClass","addClass","html","parent","showSidebar","ajax","type","async","success","result","body","explodeEditMode","initMapExplore","change","value","layerForm","markerForm","groupForm","entityFormHasUnsavedChanges","initMapForms"],"sourceRoot":""}