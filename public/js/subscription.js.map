{"version":3,"file":"/js/subscription.js","mappings":"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","sources":["webpack:///./resources/assets/js/subscription.js"],"sourcesContent":["// Strip variables for the page\nvar stripe, elements, card;\n\n// Form status\nvar formSubmit = false;\nvar formSubmitBtn;\n\n// Coupon stuff\nvar couponBtn, couponField, couponSuccess, couponError, couponId;\n\n$(document).ready(function() {\n    initStripe();\n    initPeriodToggle();\n    $('#subscribe-confirm').on('shown.bs.modal', () => {\n        initConfirmListener();\n    });\n});\n\n// Initialize the stripe API\nfunction initStripe() {\n    let token = $('#stripe-token');\n    stripe = Stripe(token.val());\n\n    // Create an instance of Elements.\n    elements = stripe.elements();\n}\n\n// When the modal is opened and loaded, inject stripe if needed and the form validator\nfunction initConfirmListener()\n{\n    formSubmitBtn = $('.subscription-confirm-button');\n\n    let cardSelector = $('#card-element');\n    if (cardSelector.length === 1) {\n        // First time opening the modal, initiate a new card\n        if (!card) {\n            // Custom styling can be passed to options when creating an Element.\n            // (Note that this demo uses a wider set of styles than the guide below.)\n            let style = {\n                base: {\n                    color: '#555555',\n                    fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n                    fontSmoothing: 'antialiased',\n                    fontSize: '14px',\n                    '::placeholder': {\n                        color: '#777777'\n                    }\n                },\n                invalid: {\n                    color: '#fa755a',\n                    iconColor: '#fa755a'\n                }\n            };\n\n            // Create an instance of the card Element.\n            card = elements.create('card', {hidePostalCode: true, style: style});\n        }\n\n        // Add an instance of the card Element into the `card-element` <div>.\n        card.mount('#card-element');\n    }\n\n    $('#subscription-confirm').submit(function (e) {\n        // If we've passed the strip validation, we can go further\n        if (formSubmit) {\n            return true;\n        }\n\n        e.preventDefault();\n        formSubmitBtn.addClass('disabled');\n        formSubmitBtn.find('span').hide();\n        formSubmitBtn.find('.spinner').show();\n\n        let intentToken = $('input[name=\"subscription-intent-token\"]');\n        let errorMessage = $('.alert-danger');\n        errorMessage.hide();\n\n        // If the form already has a payment id, we don't need stripe to add the new one\n        let cardID = $('input[name=\"payment_id\"]');\n        if (cardID.val()) {\n            formSubmit = true;\n            $('#subscription-confirm').submit();\n            return false;\n        }\n\n        stripe.confirmCardSetup(\n            intentToken.val(), {\n                payment_method: {\n                    card: card,\n                    billing_details: {\n                        name: $('input[name=\"card-holder-name\"]').val()\n                    }\n                }\n            }\n        ).then(function (result) {\n            if (result.error) {\n                formSubmitBtn.removeClass('disabled').text(formSubmitBtn.data('text'));\n                errorMessage.text(result.error.message).show();\n                return false;\n            } else {\n                cardID.val(result.setupIntent.payment_method);\n                formSubmit = true;\n                $('#subscription-confirm').submit();\n\n            }\n        }.bind(this));\n    });\n\n    $('.subscription-form').submit(function () {\n        formSubmitBtn.addClass('disabled')\n            .find('span').hide()\n            .parent().find('.spinner').show();\n\n        return true;\n    });\n\n    couponBtn = $('#coupon-check-btn');\n    couponField = $('#coupon-check');\n    couponSuccess = $('#coupon-success');\n    couponError = $('#coupon-invalid');\n    couponId = $('#coupon');\n\n    couponBtn.click(function () {\n        checkCoupon();\n    });\n    couponField.change(function() {\n        checkCoupon();\n    });\n    couponField.focus(function () {\n        formSubmitBtn.addClass('disabled').prop('disabled', true);\n    });\n    couponField.focusout(function () {\n        let coupon = couponField.val();\n        if (!coupon) {\n            formSubmitBtn.removeClass('disabled').prop('disabled', false);\n        }\n    });\n}\n\nfunction checkCoupon() {\n    let coupon = couponField.val();\n    let url = couponField.data('url');\n\n    couponBtn.prop('disabled', true)\n        .find('.check').hide()\n        .parent().find('.spinner').show();\n\n    if (!coupon) {\n        formSubmitBtn.removeClass('disabled').prop('disabled', false);\n    }\n\n    $.ajax({\n        url: url + '?coupon=' + coupon,\n        context: this\n    }).done(function (result) {\n        couponBtn\n            .prop('disabled', false)\n            .find('.check').show()\n            .parent().find('.spinner').hide();\n\n        formSubmitBtn.removeClass('disabled').prop('disabled', false);\n\n        if (!result.valid) {\n            couponSuccess.hide();\n            couponError.show();\n            couponId.val('');\n            return;\n        }\n\n        couponError.hide();\n        couponSuccess.html(result.discount).show();\n        couponId.val(result.coupon);\n    });\n}\n\nfunction initPeriodToggle() {\n    $('input[name=\"period\"]').change(function () {\n        let box = $('#pricing-overview');\n        console.log('checked?', this.checked);\n        if (this.checked) {\n            box.removeClass('period-month').addClass('period-year');\n        } else {\n            box.removeClass('period-year').addClass('period-month');\n        }\n    });\n}\n"],"names":["stripe","elements","card","formSubmitBtn","couponBtn","couponField","couponSuccess","couponError","couponId","formSubmit","checkCoupon","coupon","val","url","data","prop","find","hide","parent","show","removeClass","$","ajax","context","this","done","result","valid","html","discount","document","ready","token","Stripe","change","box","console","log","checked","addClass","on","length","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","create","hidePostalCode","mount","submit","e","preventDefault","intentToken","errorMessage","cardID","confirmCardSetup","payment_method","billing_details","name","then","error","text","message","setupIntent","bind","click","focus","focusout","initConfirmListener"],"sourceRoot":""}